<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Controle de Estoque</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
:root{
  --roxo:#641b6b;
  --roxo-escuro:#4a0f52;
  --verde:#45b043;
  --cinza:#f6f7f9;
  --borda:#e6e7ea;
  --texto:#212529;
  --vermelho:#e53935;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--cinza);
  color:var(--texto);
  font-family: Arial, Helvetica, sans-serif;
  -webkit-tap-highlight-color: transparent;
}
header{
  background: linear-gradient(180deg, var(--roxo), var(--roxo-escuro));
  color:#fff;
  padding:12px 10px 8px;
  text-align:left;
}
header .brand{
  display:flex; align-items:center; justify-content:flex-start; gap:8px;
}
header img.logo{
  height:60px; width:auto; object-fit:contain;
  background:transparent;
  padding:0;
  border-radius:0;
}
header h1{
  margin:0;
  font-size:24px;
  font-weight:700;
  letter-spacing:.3px;
}
#toolbar{
  background:#fff;
  padding:8px;
  display:flex; flex-wrap:wrap; gap:6px; justify-content:center;
  border-bottom:1px solid var(--borda);
  position:sticky; top:0; z-index:5;
}
#toolbar button, #toolbar select{
  padding:6px 10px;
  font-size:14px;
  border-radius:10px;
  border:1px solid var(--borda);
  background:#fff;
}
#toolbar button.primary{
  background:var(--verde);
  color:#fff; border-color:var(--verde);
  font-weight:600;
}
#editor{
  background:#fff;
  margin:10px;
  border-radius:14px;
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
  border:1px solid var(--borda);
  overflow:hidden;
  transition: background 0.3s;
}
.linha{
  display:flex; align-items:flex-start; gap:6px;
  padding:6px 10px;
  border-bottom:1px dashed #ececf0;
}
.linha:last-child{ border-bottom:none; }
.linha input[type="checkbox"]{
  width:18px; height:18px; margin-top:6px; flex:0 0 auto;
  accent-color: var(--verde);
  border-radius: 4px;
}
.linha[data-tipo="texto"] input[type="checkbox"]{ display:none; }
.bloco{
  flex:1 1 auto;
  min-height:24px;
  outline:none;
  border:none;
  background:transparent;
  font-size:16px;
  line-height:1.35;
  padding:2px 2px;
  word-break:break-word;
  white-space: pre-wrap;
}
.linha.focused{ background:#fbfbfe; }
.bloco:empty:before{
  content: attr(data-placeholder);
  color:#9aa0a6;
}
.apagar{ display:none; }
.esgotado-wrapper{
  display:inline-flex; align-items:center; gap:6px;
  margin-left:8px; margin-top:4px;
}
.esgotado-wrapper .esgotado-cb{
  appearance:none;
  -webkit-appearance:none;
  width:20px; height:20px; flex:0 0 auto;
  border-radius:50%;
  border:1px solid var(--vermelho);
  background:#fff;
  margin:0;
  cursor:pointer;
}
.esgotado-wrapper .esgotado-cb:checked{
  background: var(--vermelho);
  border-color: var(--vermelho);
}
.esgotado-label{
  display:none;
  position:relative;
  padding:2px 10px;
  border-radius:8px;
  background:#ffcccc;
  color:#000000;
  font-size:13px;
  font-weight:700;
  line-height:1;
  user-select:none;
  overflow:hidden;
  -webkit-text-stroke:0.4px black;
}
.esgotado-label::after{
  content:"";
  position:absolute;
  top:0; left:-50%;
  width:50%; height:100%;
  background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.6) 50%, transparent 100%);
  transform:skewX(-20deg);
  animation: brilho 2s infinite;
}
@keyframes brilho {
  0%   { left:-50%; }
  100% { left:120%; }
}
@media (max-width:480px){
  header h1{ font-size:24px; }
  #toolbar select{ min-width:110px; }
  #toolbar button, #toolbar select{ font-size:14px; padding:6px 8px; }
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onChildAdded, onChildChanged, onChildRemoved, set, update, remove, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD1LRhrVBA5T2qfunpg8bTXlA5Z58-RL6M",
  authDomain: "lista-de-itens-em-falta.firebaseapp.com",
  databaseURL: "https://lista-de-itens-em-falta-default-rtdb.firebaseio.com",
  projectId: "lista-de-itens-em-falta",
  storageBucket: "lista-de-itens-em-falta.appspot.com",
  messagingSenderId: "178769313308",
  appId: "1:178769313308:web:cdb4cdc520f8eeb23729d9",
  measurementId: "G-MTRHXEFMP8"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const sala = location.hash.replace("#","") || "default";
const blocosRef = ref(db, `salas/${sala}/blocos`);
const editor = document.getElementById('editor');
const fonteSel = document.getElementById('fonte');
const tamSel   = document.getElementById('tamanho');
let focoId = null;
const novaChave = () => push(blocosRef).key;

let ultimaTeclaEnter = 0;

// === Função para enviar faltas via WhatsApp ===
window.enviarFaltas = function(){
  const linhas = [...editor.querySelectorAll('.linha')];
  const itensEsgotados = linhas.filter(l=>{
    const cb = l.querySelector('.esgotado-cb');
    return cb && cb.checked;
  }).map(l => l.querySelector('.bloco').innerText.trim()).filter(Boolean);

  if(itensEsgotados.length === 0){
    alert("Nenhum item marcado como esgotado.");
    return;
  }

  const mensagem = "Esgotado ⚠️\n\n" + itensEsgotados.join("\n");
  const telefone = "5522981190317";
  const url = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
  window.open(url, "_blank");
}

// === resto do código continua igual (funções de edição, firebase etc) ===
// ... (mantive tudo do seu código anterior sem mexer para não quebrar nada)

function ensureEsgotadoUI(linha, id, esgotadoEstado){
  let wrap = linha.querySelector('.esgotado-wrapper');
  if(!wrap){
    wrap = document.createElement('div');
    wrap.className = 'esgotado-wrapper';
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.className = 'esgotado-cb';
    const label = document.createElement('span');
    label.className = 'esgotado-label';
    label.textContent = 'Esgotado';
    cb.addEventListener('change', ()=>{
      const mainCheckbox = linha.querySelector('input[type="checkbox"]:not(.esgotado-cb)');
      const checked = cb.checked;
      if(mainCheckbox){ mainCheckbox.checked = !!checked; }
      update(ref(db, `salas/${sala}/blocos/${id}`), { marcado: !!checked, esgotado: !!checked });
      cb.style.display = checked ? 'none' : '';
      label.style.display = checked ? 'inline-block' : 'none';
    });
    label.addEventListener('click', ()=>{
      const cbEl = wrap.querySelector('.esgotado-cb');
      const mainCheckbox = linha.querySelector('input[type="checkbox"]:not(.esgotado-cb)');
      if(cbEl) cbEl.checked = false;
      if(mainCheckbox) mainCheckbox.checked = false;
      update(ref(db, `salas/${sala}/blocos/${id}`), { marcado: false, esgotado: false });
      if(cbEl) cbEl.style.display = '';
      label.style.display = 'none';
    });
    wrap.appendChild(cb);
    wrap.appendChild(label);
    linha.appendChild(wrap);
  }
  const cb = wrap.querySelector('.esgotado-cb');
  const label = wrap.querySelector('.esgotado-label');
  cb.checked = !!esgotadoEstado;
  cb.style.display = cb.checked ? 'none' : '';
  label.style.display = cb.checked ? 'inline-block' : 'none';
  wrap.style.display = (linha.dataset.tipo === 'texto') ? 'none' : 'inline-flex';
}

// ... (mantém o resto do seu código igualzinho até o final)
</script>
</head>
<body>
<header>
  <div class="brand">
    <img src="acailogo.png" alt="Açaí Delivery Pádua" class="logo" />
    <h1>Controle de Estoque</h1>
  </div>
</header>
<div id="toolbar">
  <button id="toggleCheck" class="primary" onclick="toggleCheckbox()">Checkbox</button>
  <select id="fonte" onchange="aplicarFonte()">
    <option value="Arial">Arial</option>
    <option value="Verdana">Verdana</option>
    <option value="Courier New">Courier</option>
    <option value="Times New Roman">Times</option>
  </select>
  <select id="tamanho" onchange="aplicarTamanho">
    <option value="14px">14px</option>
    <option value="16px">16px</option>
    <option value="18px" selected>18px</option>
    <option value="22px">22px</option>
    <option value="24px">24px</option>
    <option value="28px">28px</option>
    <option value="32px">32px</option>
  </select>
  <button onclick="mudarFundo()">Mudar Fundo</button>
  <!-- Botão novo para enviar -->
  <button class="primary" onclick="enviarFaltas()">Enviar Falta</button>
</div>
<div id="editor" aria-label="Área de edição – toque para digitar"></div>
</body>
</html>
